(()=>{"use strict";const e=window.wp.blocks,o=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"formello/library","title":"Form Library","description":"A block to display or create forms.","category":"formello","textdomain":"formello","attributes":{"ref":{"type":"number"}},"supports":{"html":false,"lock":false,"reusable":false,"inserter":true},"editorScript":"file:./index.js"}'),t=window.wp.data,r=window.wp.coreData,l=window.wp.components,n=window.wp.i18n,s=window.wp.blockEditor,a=window.wp.element,i=window.ReactJSXRuntime;function c({selectedCategory:e,patternCategories:o,onClickCategory:t}){const r="block-editor-block-patterns-explorer__sidebar";return(0,i.jsx)("div",{className:`${r}__categories-list`,children:[...new Set(o)].map((o=>(0,i.jsx)(l.Button,{label:o.name,className:`${r}__categories-list__item`,isPressed:e===o.slug,onClick:()=>{t(o.slug)},children:o.name},o.slug)))})}function d({searchValue:e,setSearchValue:o}){return(0,i.jsx)("div",{className:"block-editor-block-patterns-explorer__search",children:(0,i.jsx)(l.SearchControl,{__nextHasNoMarginBottom:!0,onChange:o,value:e,label:(0,n.__)("Search for patterns"),placeholder:(0,n.__)("Search")})})}function p({selectedCategory:e,patternCategories:o,onClickCategory:t,searchValue:r,setSearchValue:l}){return(0,i.jsxs)("div",{className:"block-editor-block-patterns-explorer__sidebar",children:[(0,i.jsx)(d,{searchValue:r,setSearchValue:l}),!r&&(0,i.jsx)(c,{selectedCategory:e,patternCategories:o,onClickCategory:t})]})}function m({clientId:e,blockName:o,onRequestClose:r}){const{replaceBlock:c}=(0,t.useDispatch)(s.store),[d,m]=(0,a.useState)(),[u,_]=(0,a.useState)("all"),h=(0,t.useSelect)((t=>{const{getBlockRootClientId:r,getPatternsByBlockTypes:l}=t(s.store),n=r(e);return l(o,n)}),[e,o]),f=h.filter((e=>d?e.title.toLowerCase().includes(d):"all"===u||e.categories.includes(u))),g=[{slug:"all",name:(0,n.__)("All","popper")},{slug:"promo",name:(0,n.__)("Promo","popper")},{slug:"top-bar",name:(0,n.__)("Top bar","popper")},{slug:"ad-block",name:(0,n.__)("Ad Block","popper")}];return h.map((e=>e.categories)).join(",").split(","),(0,i.jsx)(l.Modal,{className:"block-editor-query-pattern__selection-modal",isFullScreen:!0,title:(0,n.__)("Choose a form","formello"),closeLabel:(0,n.__)("Cancel"),onRequestClose:r,children:(0,i.jsxs)("div",{className:"block-editor-block-patterns-explorer",children:[(0,i.jsx)(p,{selectedCategory:u,patternCategories:g,onClickCategory:_,searchValue:d,setSearchValue:m}),(0,i.jsx)("div",{className:"block-editor-block-patterns-explorer__list",children:(0,i.jsx)(s.BlockContextProvider,{value:{postType:"formello_form"},children:(0,i.jsx)(s.__experimentalBlockPatternsList,{blockPatterns:f,shownPatterns:f,onClickPattern:o=>{c(e,o.blocks)}})})})]})})}const u=window.React;var _;function h(){return h=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},h.apply(null,arguments)}(0,e.registerBlockType)(o,{icon:function(e){return u.createElement("svg",h({xmlns:"http://www.w3.org/2000/svg",width:341.333,height:341.333,viewBox:"0 0 256 256"},e),_||(_=u.createElement("path",{fill:"#9b51e0",d:"M0 128v128h256V0H0v128zm145.6-66.6c2.9.7 7.8 2.8 11.1 4.5 6.7 3.6 18.3 14.6 16.8 16-2.6 2.3-31.9 23.1-32.6 23.1-.5 0-.9-.5-.9-1 0-.6-1.1-2.2-2.5-3.5-3-3.1-8.3-3.3-11.6-.6-2.2 1.8-2.4 2.7-2.7 14l-.4 12.1H136v37h-13v34H82v-44.8c0-35.5.3-46.1 1.5-51.7 3.9-18.6 18.2-34.2 35.6-38.9 6.9-1.9 19.9-2 26.5-.2z"})))},edit:function({attributes:{ref:e},clientId:o,name:c,setAttributes:d}){const[p,u]=(0,a.useState)(!1),[_,h]=(0,a.useState)(!0),[f,g]=(0,a.useState)(""),{innerBlocks:x,userCanEdit:b,getBlockEditingMode:k,onNavigateToEntityRecord:v,editingMode:C,hasPatternOverridesSource:j}=(0,t.useSelect)((t=>{const{canUser:l}=t(r.store),{getBlocks:n,getSettings:a,getBlockEditingMode:i}=t(s.store);return{innerBlocks:n(o),userCanEdit:l("update","blocks",e),getBlockEditingMode:i,onNavigateToEntityRecord:a().onNavigateToEntityRecord,editingMode:i(o)}}),[o,e]),w=(0,s.useHasRecursion)(e),{record:y,hasResolved:B}=(0,r.useEntityRecord)("postType","formello_form",e),S=B&&!y,N=(0,t.useSelect)((e=>{const o=e("core").getEntityRecords("postType","formello_form",{per_page:-1}),t=[{value:"",label:(0,n.__)("Select a form","formello")}];return o?.forEach((e=>{t.push({value:e.id,label:e.title.raw||(0,n.__)("No title","formello")})})),t}),[]),{saveEntityRecord:E}=(0,t.useDispatch)(r.store),P=(0,a.useCallback)((async(e=null)=>E("postType","formello_form",{title:e,content:'\x3c!-- wp:formello/form {"lock":{"move":false,"remove":true}} --\x3e\n\t\t\t\t<form class="wp-block-formello-form" method="post" data-id="11" data-validate="true" novalidate action=""><input type="hidden" name="_formello_id" value="11"/><input type="text" name="_formello_h11" class="formello-hp" tabindex="-1"/><input type="hidden" name="action" value="formello"/><div class="formello-message" id="formello-message-11"></div></form>\n\t\t\t\t\x3c!-- /wp:formello/form --\x3e',status:"publish",excerpt:""}).then((e=>{d({ref:e.id}),h(!1)}))),[E,d]),[R,I,T]=(0,r.useEntityBlockEditor)("postType","formello_form",{id:e}),V=(0,s.useBlockProps)({className:"block-library-block__reusable-block-container"}),M=(0,s.useInnerBlocksProps)(V,{value:R,onInput:I,onChange:T,allowedBlocks:["formello/form"],renderAppender:R?.length?void 0:s.InnerBlocks.ButtonBlockAppender});return w?(0,i.jsx)("div",{...V,children:(0,i.jsx)(s.Warning,{children:(0,n.__)("Block cannot be rendered inside itself.")})}):!e||S?(0,i.jsxs)("div",{...V,children:[(0,i.jsx)(s.InspectorControls,{children:(0,i.jsx)(l.PanelBody,{title:(0,n.__)("Form Settings","formello"),initialOpen:!0,children:(0,i.jsx)(l.SelectControl,{label:(0,n.__)("Choose a form","formello"),options:N,onChange:e=>{d({ref:parseInt(e)})}})})}),(0,i.jsx)(l.Placeholder,{instructions:(0,n.__)("Insert from library or create a new form.","formello"),label:(0,n.__)("Insert a form","formello"),children:"widgets"===window.pagenow?(0,i.jsx)(l.SelectControl,{label:(0,n.__)("Choose a form","formello"),value:e,options:N,onChange:e=>{d({ref:parseInt(e)})}}):(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)(l.Button,{isPrimary:!0,icon:"book",onClick:()=>{u("templates")},children:(0,n.__)("Open Library","formello")}),(0,i.jsx)(l.Button,{variant:"secondary",onClick:()=>{u("create")},children:(0,n.__)("Create a new form","formello")})]})}),"create"===p&&(0,i.jsx)(l.Modal,{title:(0,n.__)("Create Reusable form"),onRequestClose:()=>{u(!1),g("")},overlayClassName:"reusable-blocks-menu-items__convert-modal",children:(0,i.jsx)("form",{onSubmit:e=>{e.preventDefault(),P(f),u(!1),g("")},children:(0,i.jsxs)(l.__experimentalVStack,{spacing:"5",children:[(0,i.jsx)(l.TextControl,{__nextHasNoMarginBottom:!0,label:(0,n.__)("Name"),value:f,onChange:g}),(0,i.jsxs)(l.__experimentalHStack,{justify:"right",children:[(0,i.jsx)(l.Button,{variant:"tertiary",onClick:()=>{u(!1),g("")},children:(0,n.__)("Cancel")}),(0,i.jsx)(l.Button,{variant:"primary",type:"submit",children:(0,n.__)("Save")})]})]})})}),"templates"===p&&(0,i.jsx)(m,{clientId:o,onRequestClose:()=>u(!1),blockName:c})]}):S?(0,i.jsx)("div",{...V,children:(0,i.jsx)(s.Warning,{actions:[(0,i.jsx)(l.Button,{variant:"primary",onClick:()=>d({ref:""}),children:(0,n.__)("Create a new form")},"create-new")],children:(0,n.__)("Block has been deleted or is unavailable.")})}):B?(0,i.jsxs)(s.RecursionProvider,{uniqueId:e,children:[(0,i.jsx)(s.BlockControls,{children:(0,i.jsx)(l.ToolbarGroup,{children:(0,i.jsx)(l.ToolbarButton,{onClick:()=>{v({postId:e,postType:"formello_form"})},children:(0,n.__)("Edit original")})})}),(0,i.jsx)(s.InspectorControls,{children:(0,i.jsx)(l.PanelBody,{title:(0,n.__)("Form Settings","formello"),initialOpen:!0,children:(0,i.jsx)(l.SelectControl,{label:(0,n.__)("Choose a form","formello"),value:e,options:N,onChange:e=>{d({ref:parseInt(e)})}})})}),(0,i.jsx)("div",{...V,children:(0,i.jsx)(l.Disabled,{isDisabled:_,children:(0,i.jsx)("div",{...M})})})]}):(0,i.jsx)("div",{...V,children:(0,i.jsx)(l.Placeholder,{children:(0,i.jsx)(l.Spinner,{})})})}})})();
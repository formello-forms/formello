(()=>{"use strict";const e=window.wp.blocks,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"formello/library","title":"Form Library","description":"A block to display or create forms.","category":"formello","textdomain":"formello","attributes":{"ref":{"type":"number"}},"supports":{"html":false,"lock":false,"reusable":false,"inserter":true,"interactivity":true},"editorScript":"file:./index.js","viewScriptModule":"file:./view.js"}'),o=window.wp.data,r=window.wp.coreData,l=window.wp.components,n=window.wp.i18n,s=window.wp.blockEditor,a=window.wp.element,i=window.ReactJSXRuntime;function c({selectedCategory:e,patternCategories:t,onClickCategory:o}){const r="block-editor-block-patterns-explorer__sidebar";return(0,i.jsx)("div",{className:`${r}__categories-list`,children:[...new Set(t)].map((t=>(0,i.jsx)(l.Button,{label:t.name,className:`${r}__categories-list__item`,isPressed:e===t.slug,onClick:()=>{o(t.slug)},children:t.name},t.slug)))})}function d({searchValue:e,setSearchValue:t}){return(0,i.jsx)("div",{className:"block-editor-block-patterns-explorer__search",children:(0,i.jsx)(l.SearchControl,{__nextHasNoMarginBottom:!0,onChange:t,value:e,label:(0,n.__)("Search for patterns"),placeholder:(0,n.__)("Search")})})}function p({selectedCategory:e,patternCategories:t,onClickCategory:o,searchValue:r,setSearchValue:l}){return(0,i.jsxs)("div",{className:"block-editor-block-patterns-explorer__sidebar",children:[(0,i.jsx)(d,{searchValue:r,setSearchValue:l}),!r&&(0,i.jsx)(c,{selectedCategory:e,patternCategories:t,onClickCategory:o})]})}function m({clientId:e,blockName:t,onRequestClose:r}){const{replaceBlock:c}=(0,o.useDispatch)(s.store),[d,m]=(0,a.useState)(),[u,_]=(0,a.useState)("all"),h=(0,o.useSelect)((o=>{const{getBlockRootClientId:r,getPatternsByBlockTypes:l}=o(s.store),n=r(e);return l(t,n)}),[e,t]),f=h.filter((e=>d?e.title.toLowerCase().includes(d):"all"===u||e.categories.includes(u))),x=[{slug:"all",name:(0,n.__)("All","popper")},{slug:"promo",name:(0,n.__)("Promo","popper")},{slug:"top-bar",name:(0,n.__)("Top bar","popper")},{slug:"ad-block",name:(0,n.__)("Ad Block","popper")}];return h.map((e=>e.categories)).join(",").split(","),(0,i.jsx)(l.Modal,{className:"block-editor-query-pattern__selection-modal",isFullScreen:!0,title:(0,n.__)("Choose a form","formello"),closeLabel:(0,n.__)("Cancel"),onRequestClose:r,children:(0,i.jsxs)("div",{className:"block-editor-block-patterns-explorer",children:[(0,i.jsx)(p,{selectedCategory:u,patternCategories:x,onClickCategory:_,searchValue:d,setSearchValue:m}),(0,i.jsx)("div",{className:"block-editor-block-patterns-explorer__list",children:(0,i.jsx)(s.BlockContextProvider,{value:{postType:"formello_form"},children:(0,i.jsx)(s.__experimentalBlockPatternsList,{blockPatterns:f,shownPatterns:f,onClickPattern:t=>{c(e,t.blocks)}})})})]})})}const u=()=>{};function _(e,t){t.forEach((t=>{e(t.clientId,"disabled"),_(e,t.innerBlocks,t.name)}))}const h=window.React;var f;function x(){return x=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)({}).hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},x.apply(null,arguments)}(0,e.registerBlockType)(t,{icon:function(e){return h.createElement("svg",x({xmlns:"http://www.w3.org/2000/svg",width:341.333,height:341.333,viewBox:"0 0 256 256"},e),f||(f=h.createElement("path",{fill:"#9b51e0",d:"M0 128v128h256V0H0v128zm145.6-66.6c2.9.7 7.8 2.8 11.1 4.5 6.7 3.6 18.3 14.6 16.8 16-2.6 2.3-31.9 23.1-32.6 23.1-.5 0-.9-.5-.9-1 0-.6-1.1-2.2-2.5-3.5-3-3.1-8.3-3.3-11.6-.6-2.2 1.8-2.4 2.7-2.7 14l-.4 12.1H136v37h-13v34H82v-44.8c0-35.5.3-46.1 1.5-51.7 3.9-18.6 18.2-34.2 35.6-38.9 6.9-1.9 19.9-2 26.5-.2z"})))},edit:function({attributes:{ref:e},clientId:t,name:c,setAttributes:d}){const[p,h]=(0,a.useState)(!1),[f,x]=(0,a.useState)(!0),[g,b]=(0,a.useState)(""),{onNavigateToEntityRecord:k,innerBlocks:C,editingMode:v}=(0,o.useSelect)((o=>{const{canUser:l}=o(r.store),{getBlocks:n,getSettings:a,getBlockEditingMode:i}=o(s.store);return{innerBlocks:n(t),userCanEdit:l("update","blocks",e),getBlockEditingMode:i,onNavigateToEntityRecord:a().onNavigateToEntityRecord,editingMode:i(t)}}),[t,e]),j=(0,s.useHasRecursion)(e),{record:w,hasResolved:y}=(0,r.useEntityRecord)("postType","formello_form",e),B=y&&!w,S=(0,o.useSelect)((e=>{const t=e("core").getEntityRecords("postType","formello_form",{per_page:-1}),o=[{value:"",label:(0,n.__)("Select a form","formello")}];return t?.forEach((e=>{o.push({value:e.id,label:e.title.raw||(0,n.__)("No title","formello")})})),o}),[]),{saveEntityRecord:N}=(0,o.useDispatch)(r.store),{setBlockEditingMode:E}=(0,o.useDispatch)(s.store);(0,a.useEffect)((()=>{_(E,C)}),[v,C,E]);const R=(0,a.useCallback)((async(e=null)=>N("postType","formello_form",{title:e,content:'\x3c!-- wp:formello/form {"lock":{"move":false,"remove":true}} --\x3e\n\t\t\t\t<form method="post" class="wp-block-formello-form" novalidate>\n\t\t\t\t<input type="hidden" name="_formello_id"/>\n\t\t\t\t<input type="text" class="formello-hp" tabindex="-1"/>\n\t\t\t\t<input type="hidden" name="action" value="formello"/>\n\t\t\t\t</form>\n\t\t\t\t\x3c!-- /wp:formello/form --\x3e',status:"publish",excerpt:""}).then((e=>{d({ref:e.id}),x(!0)}))),[N,d]),[I]=(0,r.useEntityBlockEditor)("postType","formello_form",{id:e}),P=(0,s.useBlockProps)({className:"block-library-block__reusable-block-container"}),M=(0,s.useInnerBlocksProps)(P,{templateLock:"all",value:I,onInput:u,onChange:u,editingMode:"disabled",allowedBlocks:["formello/form"],renderAppender:I?.length?void 0:s.InnerBlocks.ButtonBlockAppender});return j?(0,i.jsx)("div",{...P,children:(0,i.jsx)(s.Warning,{children:(0,n.__)("Block cannot be rendered inside itself.")})}):!e||B?(0,i.jsxs)("div",{...P,children:[(0,i.jsx)(s.InspectorControls,{children:(0,i.jsx)(l.PanelBody,{title:(0,n.__)("Form Settings","formello"),initialOpen:!0,children:(0,i.jsx)(l.SelectControl,{label:(0,n.__)("Choose a form","formello"),options:S,onChange:e=>{d({ref:parseInt(e)})},__nextHasNoMarginBottom:!0})})}),(0,i.jsx)(l.Placeholder,{instructions:(0,n.__)("Insert from library or create a new form.","formello"),label:(0,n.__)("Insert a form","formello"),children:"widgets"===window.pagenow?(0,i.jsx)(l.SelectControl,{label:(0,n.__)("Choose a form","formello"),value:e,options:S,onChange:e=>{d({ref:parseInt(e)})},__nextHasNoMarginBottom:!0}):(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)(l.Button,{isPrimary:!0,icon:"book",onClick:()=>{h("templates")},children:(0,n.__)("Open Library","formello")}),(0,i.jsx)(l.Button,{variant:"secondary",onClick:()=>{h("create")},children:(0,n.__)("Create a new form","formello")})]})}),"create"===p&&(0,i.jsx)(l.Modal,{title:(0,n.__)("Create Reusable form"),onRequestClose:()=>{h(!1),b("")},overlayClassName:"reusable-blocks-menu-items__convert-modal",children:(0,i.jsx)("form",{onSubmit:e=>{e.preventDefault(),R(g),h(!1),b("")},children:(0,i.jsxs)(l.__experimentalVStack,{spacing:"5",children:[(0,i.jsx)(l.TextControl,{__nextHasNoMarginBottom:!0,label:(0,n.__)("Name"),value:g,onChange:b}),(0,i.jsxs)(l.__experimentalHStack,{justify:"right",children:[(0,i.jsx)(l.Button,{variant:"tertiary",onClick:()=>{h(!1),b("")},children:(0,n.__)("Cancel")}),(0,i.jsx)(l.Button,{variant:"primary",type:"submit",children:(0,n.__)("Save")})]})]})})}),"templates"===p&&(0,i.jsx)(m,{clientId:t,onRequestClose:()=>h(!1),blockName:c})]}):B?(0,i.jsx)("div",{...P,children:(0,i.jsx)(s.Warning,{actions:[(0,i.jsx)(l.Button,{variant:"primary",onClick:()=>d({ref:""}),children:(0,n.__)("Create a new form")},"create-new")],children:(0,n.__)("Block has been deleted or is unavailable.")})}):y?(0,i.jsxs)(s.RecursionProvider,{uniqueId:e,children:[(0,i.jsx)(s.BlockControls,{children:(0,i.jsx)(l.ToolbarGroup,{children:(0,i.jsx)(l.ToolbarButton,{onClick:()=>{k({postId:e,postType:"formello_form"})},children:(0,n.__)("Edit form","formello")})})}),(0,i.jsx)(s.InspectorControls,{children:(0,i.jsx)(l.PanelBody,{title:(0,n.__)("Form Settings","formello"),initialOpen:!0,children:(0,i.jsx)(l.SelectControl,{label:(0,n.__)("Choose a form","formello"),value:e,options:S,onChange:e=>{d({ref:parseInt(e)})},__nextHasNoMarginBottom:!0})})}),(0,i.jsx)("div",{...P,children:(0,i.jsx)("div",{...M})})]}):(0,i.jsx)("div",{...P,children:(0,i.jsx)(l.Placeholder,{children:(0,i.jsx)(l.Spinner,{})})})}})})();
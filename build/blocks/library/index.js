!function(){"use strict";var e=window.wp.blocks,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"formello/library","title":"Form Library","description":"A block to display or create forms.","category":"widgets","textdomain":"formello","attributes":{"ref":{"type":"number"}},"supports":{"html":false,"lock":false,"reusable":false,"inserter":true},"editorScript":"file:./index.js"}'),l=window.React,o=window.wp.data,r=window.wp.coreData,a=window.wp.components,n=window.wp.i18n,s=window.wp.blockEditor,c=window.wp.primitives,i=(0,l.createElement)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(c.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),m=window.wp.element;function p({selectedCategory:e,patternCategories:t,onClickCategory:o}){const r="block-editor-block-patterns-explorer__sidebar";return(0,l.createElement)("div",{className:`${r}__categories-list`},[...new Set(t)].map((t=>(0,l.createElement)(a.Button,{key:t,label:t,className:`${r}__categories-list__item`,isPressed:e===t,onClick:()=>{o(t)}},t))))}function u({searchValue:e,setSearchValue:t}){return(0,l.createElement)("div",{className:"block-editor-block-patterns-explorer__search"},(0,l.createElement)(a.SearchControl,{__nextHasNoMarginBottom:!0,onChange:t,value:e,label:(0,n.__)("Search for patterns"),placeholder:(0,n.__)("Search")}))}function d({selectedCategory:e,patternCategories:t,onClickCategory:o,searchValue:r,setSearchValue:a}){return(0,l.createElement)("div",{className:"block-editor-block-patterns-explorer__sidebar"},(0,l.createElement)(u,{searchValue:r,setSearchValue:a}),!r&&(0,l.createElement)(p,{selectedCategory:e,patternCategories:t,onClickCategory:o}))}var _,f=function({clientId:e,blockName:t,setIsPatternSelectionModalOpen:r}){const{updateBlockAttributes:c,replaceInnerBlocks:i}=(0,o.useDispatch)(s.store),[p,u]=(0,m.useState)(""),[_,f]=(0,m.useState)("all"),b=(0,o.useSelect)((l=>{const{getBlockRootClientId:o,getPatternsByBlockTypes:r}=l(s.store),a=o(e);return r(t,a)}),[e,t]),h=b.map((e=>e.formello_categories)).join(",").split(","),k=b.filter((e=>p?e.title.toLowerCase().includes(p):"all"===_||e.formello_categories.includes(_)));return(0,l.createElement)(a.Modal,{isFullScreen:!0,title:(0,n.__)("Choose a pattern"),closeLabel:(0,n.__)("Cancel"),onRequestClose:()=>r(!1)},(0,l.createElement)("div",{className:"block-editor-block-patterns-explorer"},(0,l.createElement)(d,{selectedCategory:_,patternCategories:h,onClickCategory:f,searchValue:p,setSearchValue:u}),(0,l.createElement)("div",{className:"block-editor-block-patterns-explorer__list"},(0,l.createElement)(s.BlockContextProvider,{value:{postType:"formello_form"}},(0,l.createElement)(s.__experimentalBlockPatternsList,{blockPatterns:k,shownPatterns:k,onClickPattern:l=>{"formello/library"===t?(c(e,{ref:parseInt(l.blocks[0].attributes.id)}),r(!1)):(i(e,l.blocks[0].innerBlocks),r(!1))}})))))};function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o])}return e},b.apply(this,arguments)}(0,e.registerBlockType)(t,{icon:function(e){return l.createElement("svg",b({xmlns:"http://www.w3.org/2000/svg",width:341.333,height:341.333,viewBox:"0 0 256 256"},e),_||(_=l.createElement("path",{fill:"#9b51e0",d:"M0 128v128h256V0H0v128zm145.6-66.6c2.9.7 7.8 2.8 11.1 4.5 6.7 3.6 18.3 14.6 16.8 16-2.6 2.3-31.9 23.1-32.6 23.1-.5 0-.9-.5-.9-1 0-.6-1.1-2.2-2.5-3.5-3-3.1-8.3-3.3-11.6-.6-2.2 1.8-2.4 2.7-2.7 14l-.4 12.1H136v37h-13v34H82v-44.8c0-35.5.3-46.1 1.5-51.7 3.9-18.6 18.2-34.2 35.6-38.9 6.9-1.9 19.9-2 26.5-.2z"})))},edit:function({attributes:{ref:e},clientId:t,setAttributes:c}){const[p,u]=(0,m.useState)(!1),[d,_]=(0,m.useState)(!0),[b,h]=(0,m.useState)(""),k=(0,s.__experimentalUseHasRecursion)(e),{record:v,hasResolved:E}=(0,r.useEntityRecord)("postType","formello_form",e),g=E&&!v,w=(0,o.useSelect)((e=>{const t=e("core").getEntityRecords("postType","formello_form",{per_page:-1}),l=[{value:"",label:(0,n.__)("Select a form","formello")}];return t?.forEach((e=>{l.push({value:e.id,label:e.title.raw||(0,n.__)("No title","formello")})})),l}),[t]),{saveEntityRecord:C}=(0,o.useDispatch)(r.store),y=(0,m.useCallback)((async(e=null,t=[],l="formello-private")=>C("postType","formello_form",{title:e,content:'\x3c!-- wp:formello/form {"lock":{"move":false,"remove":true}} --\x3e\n\t\t\t\t<form class="wp-block-formello-form" method="post" data-id="11" data-validate="true" novalidate action=""><input type="hidden" name="_formello_id" value="11"/><input type="text" name="_formello_h11" class="formello-hp" aria-label="If you are human, leave this field blank." tabindex="-1"/><input type="hidden" name="action" value="formello"/><div class="formello-message" id="formello-message-11"></div></form>\n\t\t\t\t\x3c!-- /wp:formello/form --\x3e',status:"publish",excerpt:""}).then((e=>{c({ref:e.id}),_(!1)})).catch((e=>{console.log(e)}))),[C]),[B,S,x]=(0,r.useEntityBlockEditor)("postType","formello_form",{id:e}),[P,I]=(0,r.useEntityProp)("postType","formello_form","title",e),N=(0,s.useBlockProps)({className:"block-library-block__reusable-block-container"}),T=(0,s.useInnerBlocksProps)(N,{value:B,onInput:S,onChange:x,allowedBlocks:["formello/form"],renderAppender:B?.length?void 0:s.InnerBlocks.ButtonBlockAppender});return k?(0,l.createElement)("div",{...N},(0,l.createElement)(s.Warning,null,(0,n.__)("Block cannot be rendered inside itself."))):!e||g?(0,l.createElement)("div",{...N},(0,l.createElement)(s.InspectorControls,null,(0,l.createElement)(a.PanelBody,{title:(0,n.__)("Form Settings","formello"),initialOpen:!0},(0,l.createElement)(a.SelectControl,{label:(0,n.__)("Choose a form","formello"),options:w,onChange:e=>{c({ref:parseInt(e)})}}))),(0,l.createElement)(a.Placeholder,{instructions:(0,n.__)("Insert from library or create a new form.","formello"),label:(0,n.__)("Insert a form","formello")},"widgets"===pagenow?(0,l.createElement)(a.SelectControl,{label:(0,n.__)("Choose a form","formello"),value:e,options:w,onChange:e=>{c({ref:parseInt(e)})}}):(0,l.createElement)(m.Fragment,null,(0,l.createElement)(a.Button,{isPrimary:!0,icon:"book",onClick:()=>{u("templates")}},(0,n.__)("Open Library","formello")),(0,l.createElement)(a.Button,{variant:"secondary",onClick:()=>{u("create")}},(0,n.__)("Create a new form","formello")))),"create"===p&&(0,l.createElement)(a.Modal,{title:(0,n.__)("Create Reusable form"),onRequestClose:()=>{u(!1),h("")},overlayClassName:"reusable-blocks-menu-items__convert-modal"},(0,l.createElement)("form",{onSubmit:e=>{e.preventDefault(),y(b),u(!1),h("")}},(0,l.createElement)(a.__experimentalVStack,{spacing:"5"},(0,l.createElement)(a.TextControl,{__nextHasNoMarginBottom:!0,label:(0,n.__)("Name"),value:b,onChange:h}),(0,l.createElement)(a.__experimentalHStack,{justify:"right"},(0,l.createElement)(a.Button,{variant:"tertiary",onClick:()=>{u(!1),h("")}},(0,n.__)("Cancel")),(0,l.createElement)(a.Button,{variant:"primary",type:"submit"},(0,n.__)("Save")))))),"templates"===p&&(0,l.createElement)(f,{blockName:"formello/library",setIsPatternSelectionModalOpen:()=>u(!1),clientId:t})):g?(0,l.createElement)("div",{...N},(0,l.createElement)(s.Warning,{actions:[(0,l.createElement)(a.Button,{variant:"primary",onClick:()=>c({ref:""}),key:"create-new"},(0,n.__)("Create a new form"))]},(0,n.__)("Block has been deleted or is unavailable."))):E?(0,l.createElement)(s.__experimentalRecursionProvider,{uniqueId:e},(0,l.createElement)(s.BlockControls,null,(0,l.createElement)(a.ToolbarGroup,null,(0,l.createElement)(a.ToolbarButton,{onClick:()=>_(!d),label:(0,n.__)("Toggle form edit","formello"),icon:i,isPressed:!d,showTooltip:!0}))),(0,l.createElement)(s.InspectorControls,null,(0,l.createElement)(a.PanelBody,{title:(0,n.__)("Form Settings","formello"),initialOpen:!0},!d&&(0,l.createElement)(a.TextControl,{__nextHasNoMarginBottom:!0,label:(0,n.__)("Name"),value:P,onChange:I}),(0,l.createElement)(a.SelectControl,{label:(0,n.__)("Choose a form","formello"),value:e,options:w,onChange:e=>{c({ref:parseInt(e)})}}))),(0,l.createElement)("div",{...N},(0,l.createElement)(a.Disabled,{isDisabled:d},(0,l.createElement)("div",{...T})))):(0,l.createElement)("div",{...N},(0,l.createElement)(a.Placeholder,null,(0,l.createElement)(a.Spinner,null)))}})}();